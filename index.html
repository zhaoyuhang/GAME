<!--
作者：赵宇航&江昊琛
创建日期：2016.7.4
基于babylon.js引擎的web前端游戏
注意：编辑时请注意保持代码风格完好
-->
<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html" charset="utf-8"/>
    <title>test</title>
    <!-- link to the last version of babylon -->
    <!--
    <script src="http://cdn.babylonjs.com/2-4/babylon.js"></script>
    -->
    <script src="babylon.2.4.js"></script>
    <script src="Oimo.js"></script>
    <script src="cannon.js"></script>
    <script src="poly2tri.js"></script>
     <script src="http://www.babylonjs.com/hand.minified-1.2.js"></script>

    <style>
        html, body {
            overflow: hidden;
            width   : 100%;
            height  : 100%;
            margin  : 0;
            padding : 0;
        }

        #renderCanvas {
            width   : 100%;
            height  : 100%;
            touch-action: none;
        }
    </style>
</head>
<body>
    <canvas id="renderCanvas"></canvas>
    <script>
        var status;
        //速度
        var speed = 1;
        var hp = 100;
         

        window.addEventListener('DOMContentLoaded', function(){
            // get the canvas DOM element
            status = 1;
            var canvas = document.getElementById('renderCanvas');

            // load the 3D engine
            var engine = new BABYLON.Engine(canvas, true);

            // createScene function that creates and return the scene
            var createScene = function(){
                // create a basic BJS Scene object
                var scene = new BABYLON.Scene(engine);

                
                var light = new BABYLON.PointLight("Omni", new BABYLON.Vector3(10, 50, 50), scene);
                
               
                var fcamera = new BABYLON.FollowCamera("FollowCam", new BABYLON.Vector3(-10, 10, 0), scene);
                // attach the camera to the canvas
                fcamera.attachControl(canvas, true);
                scene.activeCamera = fcamera;
                console.log(fcamera);
                //var material1 = new BABYLON.StandardMaterial("mat1", scene);
                //material1.diffuseColor = new BABYLON.Color3(1, 1, 0);

                 // Fog
                scene.fogMode = BABYLON.Scene.FOGMODE_EXP;
                //BABYLON.Scene.FOGMODE_NONE;
                //BABYLON.Scene.FOGMODE_EXP;
                //BABYLON.Scene.FOGMODE_EXP2;
                //BABYLON.Scene.FOGMODE_LINEAR;
            
                scene.fogColor = new BABYLON.Color3(0.9, 0.9, 0.85);
                scene.fogDensity = 0;
            
                //Only if LINEAR
                //scene.fogStart = 20.0;
                //scene.fogEnd = 60.0;

                // 天空的箱子（把相机处于一个大的箱子里面）
                var skybox = BABYLON.Mesh.CreateBox("skyBox", 2000.0, scene);
                //创建一个天空的材料
                var skyboxMaterial = new BABYLON.StandardMaterial("skyBox", scene);
                //背面效果
                skyboxMaterial.backFaceCulling = false;
                //反射的材质
                skyboxMaterial.reflectionTexture = new BABYLON.CubeTexture("textures/skybox", scene);
                //坐标模式-天空盒子
                skyboxMaterial.reflectionTexture.coordinatesMode = BABYLON.Texture.SKYBOX_MODE;
                skyboxMaterial.diffuseColor = new BABYLON.Color3(0, 0, 0);
                skyboxMaterial.specularColor = new BABYLON.Color3(0, 0, 0);
                //禁止照明
                skyboxMaterial.disableLighting = true;
                skybox.material = skyboxMaterial;

                // create a built-in "ground" shape; its constructor takes the same 5 params as the sphere's one
                //var ground = BABYLON.Mesh.CreateGround('ground1', 60, 60, -1, scene);
                //场景部分加载完毕
                var sphere_test = BABYLON.Mesh.CreateSphere("sphere",3.0 ,3.0,scene)
                sphere_test.position.x = sphere_test.position.y = sphere_test.z = 0;
                fcamera.target = sphere_test; 
                fcamera.radius = 3; // How far from the object should the camera be.
                fcamera.heightOffset = 3; // How high above the object should it be.

                
               

                 sphere_test.actionManager = new BABYLON.ActionManager(scene);
               


                
                 scene.registerBeforeRender(function(){
                    v = new BABYLON.Vector3(speed,0,0);
                    sphere_test.position.x += v.x;
                    sphere_test.position.y += v.y;
                    sphere_test.position.z += v.z;

                   
                    console.log(v);
                    //console.log(sphere_test.position);
                    //console.log(fcamera.position);
                   
                 });
                return scene;
            }

            // call the createScene function
            var scene = createScene();
            scene.debugLayer.show();

            // run the render loop
            engine.runRenderLoop(function(){
                scene.render();
            });

            // the canvas/window resize event handler
            window.addEventListener('resize', function(){
                engine.resize();
            });

            document.onkeydown = function(e){
                 var keywhich = e.which;
                 var keyChar = String.fromCharCode(keywhich);
                switch (keyChar){
              case "D":
                console.log("press D");
                  break;
              case "A":
                //cube01.position.x -= 1;
                  break;
              case "W":
               //cube01.position.y += 1;
                  break;
              case "S":
                //cube01.position.y -= 1;
                  break;
              case "J":
                //cube01.position.y -= 1;
                  break;
              case "K":
                //cube01.position.y -= 1;
                  break;
              case "U":
                //cube01.position.y -= 1;
                console.log("speed up");
                if(speed <10)
                    speed +=  0.5; 
                console.log(speed);
                  break;
              case "I":
                //cube01.position.y -= 1;
                console.log("speed down");
                if(speed > 1)
                    speed -=  0.5; 
                console.log(speed); 
                  break;
              default:
                  break;
                 }
             };
        

            
        });
    </script>
</body>
</html>